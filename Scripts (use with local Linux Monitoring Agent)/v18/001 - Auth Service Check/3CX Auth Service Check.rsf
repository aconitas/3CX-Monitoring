{"Script":{"MonScriptCategoryI3D":13,"Name":".3CX Auth Service Check","ScriptKind":0,"ScriptType":3,"Script":"##########################################################################\r\n#\r\n#   aconitas® GmbH · Bäumenheimer Str. 5 · 86690 Mertingen · Germany\r\n#   https://www.aconitas.com · info@aconitas.com · +49 (906) 126725-0\r\n#\r\n#   Version 1.0 · 2022-12-15\r\n#\r\n##########################################################################\r\n\r\n########################################################\r\n#### Import Zugangsdaten aus 3CX DB\r\nPassword=$(sudo -u postgres psql -d database_single -c \"SELECT * FROM parameter where name='WEBSERVERPASS'\" | grep WEBSERVERPASS | tr -s ' ' | cut -d ' ' -f 10)\r\nUsername=$(sudo -u postgres psql -d database_single -c \"SELECT * FROM parameter where name='WEBSERVERUSER'\" | grep WEBSERVERUSER | tr -s ' ' | cut -d ' ' -f 10)\r\n\r\n########################################################\r\n#### Import WebServerPort aus 3CX DB\r\nWEB_SERVER_PORT=$(sudo -u postgres psql -d database_single -c \"SELECT * FROM parameter where name='WEB_ROOT_LOCAL'\" | grep WEB_ROOT_LOCAL | tr -s ' ' | cut -d ' ' -f7)\r\nWEB_SERVER_PORT=${WEB_SERVER_PORT:7} \r\n\r\n########################################################\r\n#### Export WebServerPort in ConfFile auf 3CX Server\r\nif [[ $WEB_SERVER_PORT =~ ':' ]]; then\r\n echo $WEB_SERVER_PORT | sed \"s|.*:\\(.*\\)/.*|\\\\1|\" > /tmp/3cx.port\r\nelse\r\n echo 80 > /tmp/3cx.port\r\nfi\r\n\r\n########################################################\r\n#### Import WebServerPort in Variable\r\nHTTP_PORT=$(cat /tmp/3cx.port)\r\n\r\n########################################################\r\n#### Authentifizierung an 3CX Web Console\r\nRESULT=$(curl -s --request POST --cookie /tmp/3cxcookie --cookie-jar /tmp/3cxcookie --data \"{'username':'$Username','password':'$Password'}\" --header \"Content-Type: application/json\" --output - localhost:${HTTP_PORT}/api/login)\r\n\r\nif [[ $RESULT =~ 'AuthSuccess' ]]; then\r\n  echo Anmeldung erfolgreich\r\n  exit 0\r\nelse\r\n  echo Anmeldung fehlgeschlagen\r\n  exit 1\r\nfi","ExitCodeSuccess":0,"ExitCodeWarning":2,"ExitCodeError":1,"IsSelfHeal":false,"SelfHealingScript":null,"SelfHealingExitCodeSuccess":0,"SelfHealingExitCodeError":0,"ThirdPartyIdentifier":null,"ArticleCode":null},"Parameters":[]}