{"Script":{"MonScriptCategoryI3D":13,"Name":".3CX SSL Cert Check","ScriptKind":0,"ScriptType":3,"Script":"##########################################################################\n#\n#   aconitas® GmbH · Bäumenheimer Str. 5 · 86690 Mertingen · Germany\n#   https://www.aconitas.com · info@aconitas.com · +49 (906) 126725-0\n#\n#   Version 1.0 · 2022-12-15\n#\n##########################################################################\r\n\r\n########################################################\r\n#### Import FQDN aus 3CX DB\r\nFQDN=$(sudo -u postgres psql -d database_single -c \"SELECT * FROM parameter where name='WEB_ROOT_EXT_SEC'\" | grep WEB_ROOT_EXT_SEC | tr -s ' ' | cut -d ' ' -f7)\r\n\r\n########################################################\r\n#### Auswertung Restlaufzeit\r\nRestlaufzeit=$(curl $FQDN -vI --stderr - | grep \"expire date:\" | cut -d: -f 2-)\r\nConvert=$(date --date=\"$Restlaufzeit\" '+%s')\r\n\r\n########################################################\r\n#### Auswertung aktuelles Datum\r\nDatum_Aktuell=$(date '+%s')\r\n\r\n########################################################\r\n#### Auswertung restliche Laufzeit in Tagen\r\nRestlaufzeit=$(( ($Convert-$Datum_Aktuell)/86400 ))\r\n\r\nif [[ $Restlaufzeit -le $Error ]]; then\r\n   echo  ACHTUNG: Das Zertifikat $FQDN laeuft in $Restlaufzeit Tagen aus\r\n   echo Aussteller: $(curl $FQDN -vI --stderr - | grep \"issuer:\" | cut -d: -f 2-)\r\n   exit 1\r\nelif [[ $Restlaufzeit -gt $Warning ]]; then\r\n   echo  Das Zertifikat $FQDN laeuft in $Restlaufzeit Tagen aus\r\n   echo Aussteller: $(curl $FQDN -vI --stderr - | grep \"issuer:\" | cut -d: -f 2-)\r\n   exit 0\r\nelse\r\n   echo ACHTUNG: Das Zertifikat $FQDN laeuft in $Restlaufzeit Tagen aus\r\n   echo Aussteller: $(curl $FQDN -vI --stderr - | grep \"issuer:\" | cut -d: -f 2-)\r\n   exit 2\r\nfi","ExitCodeSuccess":0,"ExitCodeWarning":2,"ExitCodeError":1,"IsSelfHeal":false,"SelfHealingScript":null,"SelfHealingExitCodeSuccess":0,"SelfHealingExitCodeError":0,"ThirdPartyIdentifier":null,"ArticleCode":null},"Parameters":[{"ScriptI3D":31,"ParameterName":"$Warning","DisplayName":"Warnung (in Tagen)","DefaultValue":"21","IsRequired":false,"ValueType":2},{"ScriptI3D":31,"ParameterName":"$Error","DisplayName":"Fehler (in Tagen)","DefaultValue":"3","IsRequired":false,"ValueType":2}]}