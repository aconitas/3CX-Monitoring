{"Script":{"MonScriptCategoryI3D":27,"Name":".3CXCheck Subscription","ScriptKind":0,"ScriptType":3,"Script":"##########################################################################\r\n#\r\n#   aconitas® GmbH · Bäumenheimer Str. 5 · 86690 Mertingen · Germany\r\n#   https://www.aconitas.com · info@aconitas.com · +49 (906) 126725-0\r\n#\r\n#   Version 3CX V20 1.0 · 2024-03-01\r\n#\r\n##########################################################################\r\n\r\n########################################################\r\n#### Import WebServerPort in Variable\r\nHTTP_PORT=$(cat /tmp/3cx.port)\r\n\r\n########################################################\r\n#### Token-Extraktion und Header-Vorbereitung\r\nTOKEN=$(</tmp/3cx.token)\r\nHEADER=\"Authorization: Bearer ${TOKEN}\"\r\n\r\n########################################################\r\n#### Curl-Anfrage zum Abrufen des Systemstatus\r\nRESULT=$(curl -s \"localhost:${HTTP_PORT}/xapi/v1/SystemStatus\" -H \"${HEADER}\")\r\n\r\n########################################################\r\n#### Überprüfung der API-Antwort und Auswertung\r\n# Extrahiere die Lizenzinformationen\r\nlicense_active=$(echo \"$RESULT\" | awk -F'\"LicenseActive\":' '{print $2}' | awk -F',' '{print $1}' | tr -d ' ')\r\nexpiration_date=$(echo \"$RESULT\" | awk -F'\"ExpirationDate\":\"' '{print $2}' | awk -F'\"' '{print $1}')\r\n\r\n########################################################\r\n#### Lizenzstatus überprüfen und verbleibende Zeit anzeigen\r\nif [ -n \"$license_active\" ]; then\r\n  if [ \"$license_active\" = \"true\" ]; then\r\n    current_date=$(date \"+%Y-%m-%dT%H:%M:%S\")\r\n    \r\n    # Konvertiere Ablaufdatum und aktuelles Datum in Sekunden seit der Epoche\r\n    expiration_seconds=$(date -d \"$expiration_date\" \"+%s\")\r\n    current_seconds=$(date -d \"$current_date\" \"+%s\")\r\n    \r\n    # Berechne die Differenz in Sekunden\r\n    difference_seconds=$((expiration_seconds - current_seconds))\r\n    \r\n    # Berechne die verbleibenden Tage\r\n    remaining_days=$((difference_seconds / 86400))  # 86400 Sekunden pro Tag\r\n\r\n    if [ \"$remaining_days\" -gt 7 ]; then\r\n      echo \"Lizenz ist aktiv. Lizenz laeuft ab in $remaining_days Tagen.  ;  \"\r\n      exit 0\r\n    else\r\n      echo \"Lizenz ist aktiv, aber abgelaufen. Ablaufdatum: $expiration_date  ; \"\r\n      exit 2\r\n    fi\r\n  else\r\n    echo \"Lizenz ist nicht aktiv  ;  .\"\r\n    exit 1\r\n  fi\r\nelse\r\n  echo \"Server ist nicht erreichbar  ;  \"\r\n  exit 1\r\nfi","ExitCodeSuccess":0,"ExitCodeWarning":2,"ExitCodeError":1,"IsSelfHeal":false,"SelfHealingScript":null,"SelfHealingExitCodeSuccess":0,"SelfHealingExitCodeError":0,"ThirdPartyIdentifier":null,"ArticleCode":null,"UniqueId":null},"Parameters":[]}